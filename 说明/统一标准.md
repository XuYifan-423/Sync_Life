# 人体姿态与年龄分组关联标准文档（含知识库存储规范）

## 一、核心枚举定义（前后端统一）

### 1. 姿态状态枚举（State）

| 枚举值 | 姿态名称     | 说明                 |
| --- | -------- | ------------------ |
| 0   | LIE（躺）   | 仰卧姿态（默认测量基准姿态）     |
| 1   | STAND（站） | 直立站姿               |
| 2   | SIT（坐）   | 自然坐姿（非瘫坐 / 前倾坐姿）   |
| 3   | WALK（走）  | 正常步行姿态（步速 4-6km/h） |
| 4   | RUN（跑）   | 慢跑姿态（步速 8-10km/h）  |

### 2. 年龄分组枚举（AgeGroup）

| 枚举值    | 分组名称 | 年龄范围（周岁） | 生理特征说明                   |
| ------ | ---- | -------- | ------------------------ |
| YOUTH  | 青少年  | 11-24    | 肌肉弹性好，脊柱柔韧性强，姿态稳定性中等     |
| PRIME  | 壮年   | 25-44    | 肌肉力量充足，脊柱稳定性佳，生理弧度明显     |
| MIDDLE | 中年   | 45-59    | 椎间盘开始退变，肌肉力量减弱，姿态易出现轻微偏差 |
| SENIOR | 老年   | 60+      | 椎间盘退变、骨质增生，肌肉萎缩，脊柱前凸角减小  |

### 3. 姿态风险等级枚举（PostureRiskLevel）

| 枚举值         | 风险等级名称    | 说明                             | 对应原逻辑    |
| ----------- | --------- | ------------------------------ | -------- |
| NORMAL      | 正常        | 角度落在对应姿态 + 年龄组的标准范围内           | 原 “正常”   |
| MILD_RISK   | 轻微偏差（低风险） | 角度超出标准范围，但偏差≤10°（老年群体可放宽至≤12°） | 原 “轻微偏差” |
| SEVERE_RISK | 严重偏差（高风险） | 角度超出标准范围，且偏差＞10°（老年群体＞12°）     | 原 “严重偏差” |

> 说明：替换原布尔型`IsNormal`，用枚举精准覆盖三类状态，避免二值逻辑局限。

## 二、多姿态核心角度量化标准（按年龄分组）

以下角度均以**矢状面（侧面视角）** 测量为准，单位为 °，腰椎生理前凸角采用 Cobb 角测量法（L1 上缘与 S1 上缘夹角），躯干倾斜角为躯干与垂直线的前倾夹角。

| 测量指标  | 姿态状态     | 青少年（YOUTH，11-24 岁） | 壮年（PRIME，25-44 岁） | 中年（MIDDLE，45-59 岁） | 老年（SENIOR，60 + 岁） | 指标说明                 |
| ----- | -------- | ------------------ | ----------------- | ------------------ | ----------------- | -------------------- |
| 躯干倾斜角 | LIE（躺）   | 0-3                | 0-3               | 0-5                | 0-5               | 仰卧时躯干基本与地面平行，倾斜角极小   |
|       | STAND（站） | 0-2                | 0-2               | 0-3                | 0-4               | 直立时躯干应垂直地面，倾斜角过大提示含胸 |
|       | SIT（坐）   | 0-5                | 0-5               | 0-8                | 0-10              | 坐姿前倾角度，超出范围易导致含胸驼背   |
|       | WALK（走）  | 3-8                | 3-8               | 5-10               | 8-12              | 步行时自然前倾，角度过大易失衡      |
|       | RUN（跑）   | 8-12               | 8-12              | 10-15              | 12-15             | 奔跑时前倾角度增加，需核心稳定控制    |

## 三、偏差判定规则（核心逻辑）

1. 判定依据：以 “对应姿态 + 年龄组” 的角度标准范围为基准，结合方差最小稳定角度计算偏差值（偏差值 =| 稳定角度 - 标准范围中点值 |）；
2. 老年群体适配：若用户`ills`字段无腰椎 / 脊柱相关疾病且无不适症状，轻微偏差阈值可放宽至≤12°，严重偏差阈值同步放宽至＞12°；
3. 测量要求：所有角度需基于 “自然姿态” 测量，排除刻意挺胸、塌腰、踮脚等人为调整因素，避免无效数据干扰。

## 四、用户基础信息字段（数据库存储）

| 字段名称      | 类型           | 说明                                      |
| --------- | ------------ | --------------------------------------- |
| id        | int（整数）      | 用户唯一标识，按注册顺序分配（知识库分组核心键）                |
| phone     | string（字符串）  | 用户手机号码（用于账号关联）                          |
| identity  | string（字符串）  | 用户身份标识（如身份证号，可选）                        |
| age       | int（整数）      | 用户实际年龄（周岁）                              |
| age_group | 枚举（AgeGroup） | 按年龄自动匹配的分组（YOUTH/PRIME/MIDDLE/SENIOR）   |
| weight    | float（浮点数）   | 用户体重（单位：kg，保留 1 位小数）                    |
| height    | float（浮点数）   | 用户身高（单位：cm，保留 1 位小数）                    |
| ills      | string（字符串）  | 用户既往疾病记录（如 “腰椎间盘突出”“脊柱侧弯” 等，适配老年群体偏差判定） |

## 五、知识库存储规范（核心数据归档）

### 1. 存储核心原则

- 分组依据：以用户唯一标识`id`为核心分组键，所有相关记录归属对应`id`的专属数据区块；
- 触发记录条件：仅当 “姿态状态（State）切换” 或 “姿态风险等级（PostureRiskLevel）切换” 时，触发数据归档（避免高频重复存储）；
- 时间维度：记录 “姿态 - 风险等级” 的有效时间段（起始时间 + 结束时间），反映该状态的持续时长。

### 2. 知识库存储字段结构

| 分组键（用户 id） | 存储字段                | 字段类型                 | 字段说明                                                     |
| ---------- | ------------------- | -------------------- | -------------------------------------------------------- |
| id（int）    | record_id           | int（整数）              | 知识库记录唯一标识（自增）                                            |
|            | start_time          | DateTime（时间戳）        | 该姿态 + 风险等级的起始时间（精确到毫秒）                                   |
|            | end_time            | DateTime（时间戳）        | 该姿态 + 风险等级的结束时间（姿态 / 风险等级切换时更新，未切换时为 null）               |
|            | state               | 枚举（State）            | 姿态状态（LIE/STAND/SIT/WALK/RUN）                             |
|            | lumbar_stable_angle | float（浮点数）           | 该姿态下方差最小的腰椎生理前凸角（°，保留 1 位小数）                             |
|            | trunk_stable_angle  | float（浮点数）           | 该姿态下方差最小的躯干倾斜角（°，保留 1 位小数）                               |
|            | posture_risk_level  | 枚举（PostureRiskLevel） | 姿态风险等级（NORMAL/MILD_RISK/SEVERE_RISK）                     |
|            | age_group           | 枚举（AgeGroup）         | 用户年龄分组（关联角度标准的核心依据）                                      |
|            | ills                | string（字符串）          | 用户既往疾病记录（用于追溯判定逻辑适配依据）                                   |
|            | duration            | float（浮点数）           | 该状态的持续时长（秒，end_time 不为 null 时自动计算：end_time - start_time） |

### 3. 存储示例（用户 id=1001，age_group=YOUTH）

| record_id | start_time              | end_time                | state | lumbar_stable_angle | trunk_stable_angle | posture_risk_level | age_group | ills | duration |
| --------- | ----------------------- | ----------------------- | ----- | ------------------- | ------------------ | ------------------ | --------- | ---- | -------- |
| 1         | 2024-05-20 14:30:22.123 | 2024-05-20 14:35:10.456 | SIT   | 32.5                | 3.2                | NORMAL             | YOUTH     | 无    | 288.333  |
| 2         | 2024-05-20 14:35:10.456 | 2024-05-20 14:38:05.789 | WALK  | 36.1                | 6.8                | NORMAL             | YOUTH     | 无    | 175.333  |
| 3         | 2024-05-20 14:38:05.789 | null                    | SIT   | 42.3                | 8.5                | MILD_RISK          | YOUTH     | 无    | null     |

## 六、关键补充说明

1. 数据一致性：前后端枚举值（State/AgeGroup/PostureRiskLevel）需严格统一（含枚举名称、顺序、映射关系），避免解析异常；
2. 角度计算：方差最小稳定角度采用 “滑动窗口迭代方差算法”（窗口大小 10-20 可配置），确保高效处理前端实时数据流；
3. 历史追溯：知识库存储的`duration`字段支持后续统计用户各姿态 / 风险等级的累计时长，为健康建议提供数据支撑；
4. 异常处理：若前端数据中断或姿态异常跳变，未明确`end_time`的记录，在下次触发记录时自动补全`end_time`并计算`duration`。
